
<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using TileCache on IIS &#8212; Geographika</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=9afac83c" />
    <link rel="stylesheet" type="text/css" href="../_static/font-awesome-4.7.0/css/font-awesome.min.css?v=02f538dc" />
    <link rel="stylesheet" type="text/css" href="../_static/mastodon-timeline.min.css?v=eddf9f32" />
    <link rel="stylesheet" type="text/css" href="../_static/custom-bootstrap-sphinx.css?v=459f6afa" />
    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/ol.js?v=98716c8e"></script>
    <script src="../_static/mastodon-timeline.js?v=029d0050"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visio Data Modelling and VBA" href="visio-data-modelling-and-vba.html" />
    <link rel="prev" title="Using ArcObjects to get Unique Values from a Table" href="using-arcobjects-to-get-unique-values-from-a-table.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Geographika</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../software.html">Software</a></li>
                <li><a href="../presentations.html">Presentations</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../software.html">Software Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentations.html">Presentations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../posts/index.html">Posts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Archived Posts</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="using-arcobjects-to-get-unique-values-from-a-table.html" title="Previous Chapter: Using ArcObjects to get Unique Values from a Table"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Using ArcObje...</span>
    </a>
  </li>
  <li>
    <a href="visio-data-modelling-and-vba.html" title="Next Chapter: Visio Data Modelling and VBA"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Visio Data Mo... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">  
    <div class="body col-md-12 content" role="main">
      
  <section id="using-tilecache-on-iis">
<h1>Using TileCache on IIS<a class="headerlink" href="#using-tilecache-on-iis" title="Link to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">date<span class="colon">:</span></dt>
<dd class="field-odd"><p>2010-07-04 14:43</p>
</dd>
<dt class="field-even">author<span class="colon">:</span></dt>
<dd class="field-even"><p>admin</p>
</dd>
<dt class="field-odd">category<span class="colon">:</span></dt>
<dd class="field-odd"><p>mapserver, python, wms</p>
</dd>
<dt class="field-even">tags<span class="colon">:</span></dt>
<dd class="field-even"><p>iis, PyISAPIe, tilecache</p>
</dd>
<dt class="field-odd">slug<span class="colon">:</span></dt>
<dd class="field-odd"><p>using-tilecache-on-iis</p>
</dd>
<dt class="field-even">status<span class="colon">:</span></dt>
<dd class="field-even"><p>published</p>
</dd>
</dl>
<p><img alt="image" src="../_images/image30.png" />I’ve previously written about using <a class="reference external" href="http://geographika.co.uk/setting-up-python-on-iis7">PyISAPie to run Python
under IIS</a> ?” this
allows Python scripts to run faster than using CGI. Rather than starting
up the Python interpreter each time a request is made to the web server,
PyISAPIe starts the interpreter once and only needs to run the script at
each request.</p>
<p><a class="reference external" href="http://tilecache.org">TileCache</a> provides a Python-based WMS-C/TMS
server - this is allows you create a local disk-based cache of any WMS
server (in my case MapServer), and then connect to it through a WMS-C
client such as OpenLayers. Using a cache means that rather than have
MapServer create an image for every single request for a tile, the first
time a tile is requested the image is saved in a folder on the server.
On all subsequent requests for the same data TileCache can retrieve this
file without needing MapServer. Performance increase is incredible -
however watch out for filling up disk space, and remember to empty the
cache if you change symbology or update your data.</p>
<p>As mod_python is <a class="reference external" href="http://blog.dscpl.com.au/2010/06/modpython-project-is-now-officially.html">now officially
dead</a>
(and has been moved in Apache’s attic), it is yet another reason if you
are using Windows servers to run everything through IIS rather than the
rather clumsy Apache on Windows. Why pay for Windows, and then install a
web server port, thereby losing all the tools, security, and utilities
within Windows to manage and administer the web server?</p>
<p>The aim of this post is to describe the set up of TileCache, running
through IIS.</p>
<p><strong>Step 1</strong></p>
<p>Install and configure
<a class="reference external" href="http://geographika.co.uk/setting-up-python-on-iis7">PyISAPIe</a></p>
<p><strong>Step 2</strong></p>
<p>Place the following script in an application on IIS -
<a class="reference external" href="http://bitbucket.org/geographika/mapserver-scripts/src/tip/tilecache/tilecache.py">http://bitbucket.org/geographika/mapserver-scripts/src/tip/tilecache/tilecache.py</a>.
Set this script to be handled by PyISAPIe as described in the link in
Step 1.</p>
<p>In the script update the following line to point to your root MapServer
WMS URL. MapServer itself can also run well under IIS.</p>
<p>[python]wms_url =
‘<a class="reference external" href="http://geographika.azurewebsites.net/mapserver/mapserv.exe?'[/python">http://geographika.azurewebsites.net/mapserver/mapserv.exe?’[/python</a>]</p>
<p>A few caveats related to this script:</p>
<ul class="simple">
<li><p>the resolutions are hard-coded to the Mercator resolutions used by
Google Maps, Bing Maps, OpenStreetMap etc.</p></li>
<li><p>the SRS is coded to EPSG:3785 which is the equivalent of EPSG:900913
?” the “Google” Mercator projection. I believe the code has changed
again, but in any case it can be set by changing the script</p></li>
<li><p>parsing of the query string sent to the server is done using the
Python CGI module. There are newer modules to handle query strings,
but these may not be compatible with TileCache which is works with
Python 2.5? and 2.6 (I’ve not tried with newer versions)</p></li>
</ul>
<p><strong>Step 3</strong></p>
<p>Some minor alterations need to be made to the TileCache scripts
themselves, otherwise the following errors will occur:</p>
<p>[python]</p>
<div class="line-block">
<div class="line">Traceback (most recent call last):</div>
<div class="line-block">
<div class="line">File “C:\Python25\PyISAPIe\Http\Isapi.py”, line 49, in Request</div>
<div class="line">raise ImportError, “[Loading ‘%s’] %s” % (Env.SCRIPT_TRANSLATED,</div>
</div>
</div>
<p>str(Val))
|  ImportError: [Loading
‘\\?\c:\inetpub\wwwroot\tilecache\tilecache.py’] ‘module’ object
has no attribute ‘argv’
|  [/python]</p>
<p>This is due to the following lines in the service.py file:</p>
<div class="line-block">
<div class="line">[python]</div>
<div class="line-block">
<div class="line"># Windows doesn’t always do the ‘working directory’ check correctly.</div>
<div class="line">if sys.platform == ‘win32’:</div>
<div class="line">workingdir = os.path.abspath(os.path.join(os.getcwd(),</div>
</div>
</div>
<p>os.path.dirname(sys.argv[0])))
|  cfgfiles = (os.path.join(workingdir, “tilecache.cfg”),
os.path.join(workingdir,”..”,”tilecache.cfg”))
|  else:
|  cfgfiles = (“/etc/tilecache.cfg”, os.path.join(“..”,
“tilecache.cfg”), “tilecache.cfg”)
|  [/python]</p>
<p>It should be commented out, leaving only the last line as follows:</p>
<div class="line-block">
<div class="line">[python]</div>
<div class="line-block">
<div class="line"># Windows doesn’t always do the ‘working directory’ check correctly.</div>
<div class="line">#if sys.platform == ‘win32’:</div>
<div class="line">#  ? workingdir = os.path.abspath(os.path.join(os.getcwd(),</div>
</div>
</div>
<p>os.path.dirname(sys.argv[0])))
|  #  ? cfgfiles = (os.path.join(workingdir, “tilecache.cfg”),
os.path.join(workingdir,”..”,”tilecache.cfg”))
|  #else:
|  cfgfiles = (“/etc/tilecache.cfg”, os.path.join(“..”,
“tilecache.cfg”), “tilecache.cfg”)
|  [/python]</p>
<p>The TileCache set up should now be complete. You can point your
OpenLayers WMS tiles to the TileCache URL, and parameters will be passed
onto TileCache, which in turn will check its cache and return an image,
or call MapServer to request that a new image is generated.</p>
<p>Please let me know of any steps missed or errors encountered and I can
update the post and script accordingly.</p>
<dl class="field-list simple">
<dt class="field-odd">orphan<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<hr><section id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Link to this heading">¶</a></h2>
<img alt="http://www.gravatar.com/avatar/b61a233709f8b1999e52b2fa84d25322?s=55&amp;d=identicon&amp;r=g" class="align-left" id="comment-9" src="http://www.gravatar.com/avatar/b61a233709f8b1999e52b2fa84d25322?s=55&amp;d=identicon&amp;r=g" />
<p><a class="reference internal" href="#comment-9"><span class="std std-ref">1.</span></a> <strong>Janey</strong>
**</p>
<p>Can you explain IEnumerator??? I’m getting an error when trying to use
it.</p>
<a href="mailto:web+using-arcobjects-to-get-unique-values-from-a-table#1@geographika.co.uk?Subject=using-arcobjects-to-get-unique-values-from-a-table" target="_top">Reply</a><hr><img alt="http://www.gravatar.com/avatar/b61a233709f8b1999e52b2fa84d25322?s=55&amp;d=identicon&amp;r=g" class="align-left" id="comment-10" src="http://www.gravatar.com/avatar/b61a233709f8b1999e52b2fa84d25322?s=55&amp;d=identicon&amp;r=g" />
<p><a class="reference internal" href="#comment-10"><span class="std std-ref">2.</span></a> <strong>Janey</strong>
**</p>
<p>I’m having trouble with the CTypes also. It seems like this code is for
VB.net not VBA/VB6. Do you have a conversion??? It would help me out a
lot! I’m trying to modify it to do a few things with a table that I’m
adding to an ArcMap document. Thanks!!</p>
<a href="mailto:web+using-arcobjects-to-get-unique-values-from-a-table#2@geographika.co.uk?Subject=using-arcobjects-to-get-unique-values-from-a-table" target="_top">Reply</a><hr><img alt="http://www.gravatar.com/avatar/83fd94d85906c73f32de8b0fc2ffe209?s=55&amp;d=identicon&amp;r=g" class="align-left" id="comment-11" src="http://www.gravatar.com/avatar/83fd94d85906c73f32de8b0fc2ffe209?s=55&amp;d=identicon&amp;r=g" />
<p><a class="reference internal" href="#comment-11"><span class="std std-ref">3.</span></a> <strong>geographika</strong>
**</p>
<p>Hi,</p>
<div class="line-block">
<div class="line">The .NET sample posted here is based on an existing VBA script that</div>
</div>
<p>can be seen at
<a class="reference external" href="http://edndoc.esri.com/arcobjects/8.3/ComponentHelp/esriCore/DataStatistics_Example.htm">http://edndoc.esri.com/arcobjects/8.3/ComponentHelp/esriCore/DataStatistics_Example.htm</a>
|  Hope that helps!</p>
<a href="mailto:web+using-arcobjects-to-get-unique-values-from-a-table#3@geographika.co.uk?Subject=using-arcobjects-to-get-unique-values-from-a-table" target="_top">Reply</a><hr><a style="font-size: large; font-weight: bold;" href="mailto:web+using-tilecache-on-iis@geographika.co.uk?Subject=using-tilecache-on-iis" target="_top">Add Comment</a></section>
</section>


    </div>
      
  </div>
</div>
<script data-goatcounter="https://geographika.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023.<br/>
    </p>
  </div>
</footer>

  </body>
</html>